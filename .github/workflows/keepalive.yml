name: keep-supabase-alive

# Run once per day + allow manual trigger
on:
  schedule:
    - cron: "0 6 * * *"   # runs daily at 06:00 UTC (you can change it)
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Netlify getConfig healthcheck endpoint
        run: |
          echo "Pinging healthcheck endpoint..."
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" \
            "https://wattlytics.netlify.app/.netlify/functions/getConfig?id=healthcheck")

          echo "HTTP Status: $STATUS"

          # Consider any non-200 response still a 'successful ping'
          if [ "$STATUS" -ge 400 ]; then
            echo "Warning: Endpoint returned HTTP $STATUS, but this still prevents Supabase auto-pausing."
          fi
